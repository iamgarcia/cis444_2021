<html>
	<head>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
		<style>
			table, th, td {
				border: 1px solid black;
			}
		</style>
	</head>
	<body>
		<div id="login">
			<h2>User Login</h2>
			<label>Username:</label><br>
			<input type="text" id="userInput" name="username"></input><br>
			
			<label>Password:</label><br>
			<input type="password" id="passInput" name="password"></input><br><br>

			<input type="submit" value="Login" onclick="verification()">
		</div>

		<div id="bookList">
			<h2>Book List</h2>
			<table>
				<thead>
					<tr>
						<th></th>
						<th>Author</th>
						<th>Title</th>
						<th>Price</th>
					</tr>
				</thead>
				<tbody id="books">
				</tbody>
			</table>
		</div>

		<script>
			var token;

			$("#bookList").hide();

			async function verification() {
				const response = await $.post("/login",
					{"username": document.getElementById("userInput").value,
					"password": document.getElementById("passInput").value},
					"json");
				if(response.status == 200) {
					token = await response.data;
					getBooks();
					$("#login").hide();
					$("#bookList").show();
				} else {
					alert(response.data.message);
				}
			}

			async function getBooks() {
				const response = await $.post("/getBooks", {"jwt": token.jwt}, "json");
				for(i = 0; i < response.data.books.length; i++) {
					$("#books").append(
					"<tr><td><button id=\"" + response.data.books[i].book_id + "\" onclick=\"purchaseBook(this.id);\">Purchase</button></td>" +
					"<td>" + response.data.books[i].author + "</td>" +
					"<td>" + response.data.books[i].title + "</td>" +
					"<td>$" + response.data.books[i].price + "</td></tr>"
					);					
				}
			}

			async function purchaseBook(id) {
				const response = await $.post("/purchaseBook", {"jwt": token.jwt, "book_id": id}, "json");
				alert(response.data.message);
			}
		</script>
	</body>
</html>
